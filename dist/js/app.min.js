"use strict";window.$=window.jQuery=require("jquery");const fs=require("fs-extra"),{ipcRenderer:ipcRenderer}=require("electron"),electron=require("electron"),remote=electron.remote,dialog=remote.dialog,Store=require("electron-store"),store=new Store;function populateFontLists(){let{activePath:e,disabledPath:t}=store.get("fontDirectories");$("#active-menu").html(e),$("#disabled-menu").html(t),addItemsToList(e,t,"active"),addItemsToList(t,e,"disabled"),$(".left-panel ul, .right-panel ul").fadeIn("fast")}function updateLists(){$("#active-list li, #disabled-list li").remove(),$("#update-all").prop("disabled",!0),populateFontLists()}function addItemsToList(e,t,l){fs.readdir(e,(i,s)=>{if(i)throw i;for(let i of s){var o;fs.stat(e+i,(s,a)=>{s?s.code&&dialog.showErrorBox("An error occured whilst updating the font lists",s.code):(o=a.isDirectory()?"folder":"file",i.startsWith(".")||$(`#${l}-list`).append(`<li class="${o}" data-name="${i}" data-oldpath="${e}${i}" data-newpath="${t}${i}" data-type="${o}" title="${i}"><div>${i}</div></li>`))})}})}function move(e,t,l,i,s){fs.rename(e,t,function(e){if(e)switch(e.code){case"ENOTEMPTY":dialog.showErrorBox("An error occured whilst moving the fonts","Some items could not be moved - you may have duplicate items in your Active and Disabled folders.");break;case"ENOENT":dialog.showErrorBox("An error occured whilst moving the fonts",'Make sure the paths for the Active and Disabled directories are correctly set. If you don\'t have a "Fonts Disabled" folder in your home Library, you may need to create one.');break;default:dialog.showErrorBox("An error occured whilst moving the fonts",e.code)}l+1===i&&s()})}function deleteItems(e,t,l,i){fs.remove(e,function(e){e&&e.code&&dialog.showErrorBox("An error occured whilst deleting the fonts",e.code),t+1===l&&i()})}function updateButtonState(){$("#active-list li.selected, #disabled-list li.selected").length>0?$("#update-all").prop("disabled",!1):$("#update-all").prop("disabled",!0)}function deleteSelected(){$(".left-panel ul, .right-panel ul").fadeOut("fast");var e=0,t=$("#active-list li.selected, #disabled-list li.selected");t.each(function(l,i){deleteItems($(this).data("oldpath"),e++,t.length,updateLists)})}function exportSelected(){var e=[];$("#active-list li.selected, #disabled-list li.selected").each(function(){var t=$(this);e.push([t.data("name"),t.data("oldpath")])}),ipcRenderer.send("export-list",e)}function updateAll(){$(".left-panel ul, .right-panel ul").fadeOut("fast");var e=0,t=$("#active-list li.selected, #disabled-list li.selected");t.each(function(l,i){move($(this).data("oldpath"),$(this).data("newpath"),e++,t.length,updateLists)})}populateFontLists(),$("body").on("mouseup","#active-list li, #disabled-list li",function(e){if(3===e.which){var t=$(this).data("name"),l=$(this).data("oldpath");ipcRenderer.send("show-font-menu",[t,l])}else $(this).toggleClass("selected"),updateButtonState()}),$("#update-all").click(()=>{updateAll()}),$("#active-menu").click(e=>{e.preventDefault(),ipcRenderer.send("show-folder-menu","active")}),$("#disabled-menu").click(e=>{e.preventDefault(),ipcRenderer.send("show-folder-menu","disabled")}),ipcRenderer.on("select-all",(e,t)=>{$("#"+t+"-list li").addClass("selected"),updateButtonState()}),ipcRenderer.on("deselect-all",(e,t)=>{$("#"+t+"-list li").removeClass("selected"),updateButtonState()}),ipcRenderer.on("toggle-selection",(e,t)=>{$("#"+t+"-list li").toggleClass("selected"),updateButtonState()}),ipcRenderer.on("update-lists",()=>{$("#update-all").prop("disabled")?dialog.showErrorBox("No fonts are selected","Select the fonts you would like to activate or disable."):updateAll()}),ipcRenderer.on("delete-fonts",()=>{$("#active-list li.selected, #disabled-list li.selected").length>0?0===dialog.showMessageBox({message:"Are you sure you want to delete the selected fonts?",detail:"This operation is not reversable.",buttons:["OK","Cancel"]})&&deleteSelected():dialog.showErrorBox("No fonts are selected","Select fonts from the Active and Disabled lists to delete them from your system.")}),ipcRenderer.on("delete-single",(e,t)=>{deleteItems(t,0,1,updateLists)}),ipcRenderer.on("export-fonts",()=>{$("#active-list li.selected, #disabled-list li.selected").length>0?exportSelected():dialog.showErrorBox("No fonts are selected","Select fonts from the Active and Disabled lists to export them to the Desktop.")}),ipcRenderer.on("update-path",()=>{$("#active-list li, #disabled-list li").remove(),$("#update-all").prop("disabled",!0),populateFontLists()}),ipcRenderer.on("display-bezel",(e,t)=>{$("#overlay").html(`<div class="bezel"><div class="inner"><img src="../assets/svg/loader.svg" width="75" height="75"><span>installing</span><span>${t}</span></div></div>`).fadeIn("fast")}),ipcRenderer.on("remove-bezel",(e,t)=>{if("font-not-installed"!==t){$("#active-list li, #disabled-list li").remove(),$("#update-all").prop("disabled",!0),populateFontLists(),$("#overlay").fadeOut("fast").empty();let e=store.get("fontDirectories.activePath");new Notification("Installation Complete",{body:`The font ${t} has been installed to ${e}`})}else $("#overlay").fadeOut("fast").empty()});
//# sourceMappingURL=maps/app.min.js.map
