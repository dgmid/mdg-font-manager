"use strict";window.$=window.jQuery=require("jquery");const fs=require("fs-extra"),{ipcRenderer:ipcRenderer}=require("electron"),electron=require("electron"),remote=electron.remote,dialog=remote.dialog,Store=require("electron-store"),store=new Store,path=require("path");let modal;function populateFontLists(){let{activePath:e,disabledPath:t}=store.get("fontDirectories");$("#active-menu").html(e),$("#disabled-menu").html(t),addItemsToList(e,t,"active"),addItemsToList(t,e,"disabled"),$("#left-panel ul, #right-panel ul").fadeIn("fast")}function updateLists(){$("#active-count, #disabled-count").html("").hide(),$("#active-list li, #disabled-list li").remove(),$("#update-all").prop("disabled",!0),populateFontLists()}function addItemsToList(e,t,o){let i=store.get("appPrefs");fs.readdir(e,(a,l)=>{if(a)throw a;{let a=0;l.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),1==store.get(`fontOrder.${o}`)&&l.reverse();let s="";for(let r of l){let l;if(l=fs.statSync(e+r).isDirectory()?"folder":"file",!r.startsWith(".")){let d=i.extensions?r:path.parse(r).name;i.dividers&&s!==r.charAt(0)&&(s=r.charAt(0).toUpperCase(),$(`#${o}-list`).append(`<li class="divider"><span>${s}</span></li>`)),$(`#${o}-list`).append(`<li class="item ${l}" data-name="${r}" data-oldpath="${e}${r}" data-newpath="${t}${r}" data-type="${l}" title="${d}"><div>${d}</div></li>`),a++}}$(`#${o}-total`).html(a)}})}function move(e,t,o,i,a){fs.rename(e,t,function(e){if(e)switch(e.code){case"ENOTEMPTY":dialog.showErrorBox("An error occured whilst moving the fonts","Some items could not be moved - you may have duplicate items in your Active and Disabled folders.");break;case"ENOENT":dialog.showErrorBox("An error occured whilst moving the fonts",'Make sure the paths for the Active and Disabled directories are correctly set. If you don\'t have a "Fonts Disabled" folder in your home Library, you may need to create one.');break;default:dialog.showErrorBox("An error occured whilst moving the fonts",e.code)}o+1===i&&a()})}function deleteItems(e,t,o,i){fs.remove(e,function(e){e&&e.code&&dialog.showErrorBox("An error occured whilst deleting the fonts",e.code),t+1===o&&i()})}function updateButtonState(){$("#search").val(""),$("ul li").show();let e=$("#active-list li.selected").length,t=$("#disabled-list li.selected").length;e+t>0?$("#update-all").prop("disabled",!1):$("#update-all").prop("disabled",!0),e>0?$("#active-count").html(e).show():$("#active-count").html("").hide(),t>0?$("#disabled-count").html(t).show():$("#disabled-count").html("").hide()}function deleteSelected(){$("#left-panel ul, #right-panel ul").fadeOut("fast");var e=0,t=$("#active-list li.selected, #disabled-list li.selected");t.each(function(o,i){deleteItems($(this).data("oldpath"),e++,t.length,updateLists)})}function exportSelected(){var e=$("#active-list li.selected, #disabled-list li.selected"),t=[];e.each(function(){var e=$(this);t.push([e.data("name"),e.data("oldpath")])}),ipcRenderer.send("export-list",t)}function updateAll(){$("#left-panel ul, #right-panel ul").fadeOut("fast");var e=0,t=$("#active-list li.selected, #disabled-list li.selected");t.each(function(o,i){move($(this).data("oldpath"),$(this).data("newpath"),e++,t.length,updateLists)})}function setDragArea(e){let t=document.getElementById(e),o={location:e,list:[]};t.ondragover=(()=>($(t).addClass("dragover"),!1)),t.ondragleave=(()=>($(t).removeClass("dragover"),!1)),t.ondragend=(()=>($(t).removeClass("dragover"),!1)),t.ondrop=(e=>{e.preventDefault(),$(t).removeClass("dragover");for(let t of e.dataTransfer.files)o.list.push(t.path);ipcRenderer.send("import",o),o.list=[]})}function openModal(e,t,o,i){(modal=new remote.BrowserWindow({parent:remote.getCurrentWindow(),modal:!0,width:t,minWidth:t,maxWidth:t,height:o,minHeight:o,resizable:i,show:!1,backgroundColor:"#293641"})).loadURL(e),modal.once("ready-to-show",()=>{modal.show()})}populateFontLists(),$("body").on("mouseup","#active-list li.item, #disabled-list li.item",function(e){if(3===e.which){var t=$(this).data("name"),o=$(this).data("oldpath");ipcRenderer.send("show-font-menu",[t,o])}else $(this).toggleClass("selected"),updateButtonState()}),$("#update-all").click(()=>{updateAll()}),ipcRenderer.on("open-prefs",(e,t)=>{console.log("REC - OPEN PREFS"),openModal("file://"+__dirname+"/../html/prefs.html",360,280,!1)}),$("#active-menu").mouseup(e=>{e.preventDefault(),ipcRenderer.send("show-folder-menu","active")}),$("#disabled-menu").mouseup(e=>{e.preventDefault(),ipcRenderer.send("show-folder-menu","disabled")}),ipcRenderer.on("select-all",(e,t)=>{$("#"+t+"-list li.item").addClass("selected"),updateButtonState()}),ipcRenderer.on("deselect-all",(e,t)=>{$("#"+t+"-list li").removeClass("selected"),updateButtonState()}),ipcRenderer.on("toggle-selection",(e,t)=>{$("#"+t+"-list li.item").toggleClass("selected"),updateButtonState()}),ipcRenderer.on("find",()=>{$("#search").focus()}),ipcRenderer.on("update-lists",()=>{$("#update-all").prop("disabled")?dialog.showErrorBox("No fonts are selected","Select the fonts you would like to activate or disable."):updateAll()}),ipcRenderer.on("delete-fonts",()=>{$("#active-list li.selected, #disabled-list li.selected").length>0?0===dialog.showMessageBox({message:"Are you sure you want to delete the selected fonts?",detail:"This operation is not reversable.",buttons:["OK","Cancel"]})&&deleteSelected():dialog.showErrorBox("No fonts are selected","Select fonts from the Active and Disabled lists to delete them from your system.")}),ipcRenderer.on("delete-single",(e,t)=>{deleteItems(t,0,1,updateLists)}),ipcRenderer.on("export-fonts",()=>{$("#active-list li.selected, #disabled-list li.selected").length>0?exportSelected():dialog.showErrorBox("No fonts are selected","Select fonts from the Active and Disabled lists to export them to the Desktop.")}),ipcRenderer.on("export-ok",(e,t)=>{new Notification("MDG Font Manager",{body:`The selected fonts have been exported to: ${t}`})}),ipcRenderer.on("export-failed",()=>{new Notification("MDG Font Manager",{body:"An error occured whilst exporting the fonts."})}),ipcRenderer.on("import-ok",(e,t)=>{updateLists();new Notification("MDG Font Manager",{body:`The fonts have been installed to: ${t}`})}),ipcRenderer.on("import-failed",()=>{updateLists();new Notification("MDG Font Manager",{body:"An error occured whilst importing the fonts."})}),ipcRenderer.on("update-path",()=>{$("#active-list li, #disabled-list li").remove(),$("#update-all").prop("disabled",!0),populateFontLists()}),ipcRenderer.on("reload",()=>{updateLists()}),ipcRenderer.on("reorder",(e,t)=>{if(2==t[1]&&(t[1]=store.get(`fontOrder.${t[0]}`)),store.get(`fontOrder.${t[0]}`)==t[1]){let e=store.get("appPrefs"),o="";$(`#${t[0]}-list li.divider`).remove();let i=$(`#${t[0]}-list`).children("li.item");i=i.get().reverse(),$(`#${t[0]}-list`).empty(),i.forEach(function(i){e.dividers&&o!==$(i).data("name").charAt(0)&&(o=$(i).data("name").charAt(0).toUpperCase(),$(`#${t[0]}-list`).append(`<li class="divider"><span>${o}</span></li>`)),$(`#${t[0]}-list`).append(i)}),store.set(`fontOrder.${t[0]}`,1-t[1])}}),ipcRenderer.on("display-bezel",(e,t)=>{$("#overlay").html(`<div class="bezel"><div class="inner"><img src="../assets/svg/loader.svg" width="75" height="75"><span>installing</span><span>${t}</span></div></div>`).fadeIn("fast")}),ipcRenderer.on("remove-bezel",(e,t)=>{if("font-not-installed"!==t){$("#active-list li, #disabled-list li").remove(),$("#update-all").prop("disabled",!0),populateFontLists(),$("#overlay").fadeOut("fast").empty();let e=store.get("fontDirectories.activePath");new Notification("MDG Font Manager",{body:`The font ${t} has been installed to ${e}`})}else $("#overlay").fadeOut("fast").empty()}),setDragArea("left-panel"),setDragArea("right-panel"),$("#search").bind("keyup",function(){let e=$(this).val();$("ul li").each(function(t,o){$(o).text().toUpperCase().indexOf(e.toUpperCase())>-1?$(o).show():$(o).hasClass("selected")||$(o).hide()})});
//# sourceMappingURL=maps/app.min.js.map
