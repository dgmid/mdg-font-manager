{"version":3,"sources":["download.js"],"names":["Download","EventEmitter","defaultOptions","fill","getOptionArray","spawn","__hasProp","hasOwnProperty","__extends","child","parent","key","call","ctor","this","constructor","prototype","__super__","require","createDirs","insecure","percentage","followRedirect","_super","url","dest","options","start","command","join","download","lastProgress","Error","_child_process","on","code","emit","stderr","data","progress","toString","test","parseInt","RegExp","lastMatch","stdin","end","stop","kill","array","option","concat","src","_i","_len","_ref","_results","Object","keys","length","push","module","exports"],"mappings":"AAEA,aAEA,IAAIA,SACHC,aACAC,eACAC,KACAC,eACAC,MACAC,UAAY,GAAGC,eACfC,UAAY,SAASC,EAAOC,GAAU,IAAK,IAAIC,KAAOD,EAAcJ,UAAUM,KAAKF,EAAQC,KAAMF,EAAME,GAAOD,EAAOC,IAAQ,SAASE,IAASC,KAAKC,YAAcN,EAA8G,OAArGI,EAAKG,UAAYN,EAAOM,UAAWP,EAAMO,UAAY,IAAIH,EAAQJ,EAAMQ,UAAYP,EAAOM,UAAkBP,GAExRJ,MAAQa,QAAQ,iBAAiBb,MAEjCJ,aAAeiB,QAAQ,UAAUjB,aAEjCC,eAAiB,CAEhBiB,WAAY,CAAC,iBACbC,SAAU,CAAC,cACXC,WAAY,CAAC,kBACbC,eAAgB,CAAC,eAGlBtB,SAAW,SAAUuB,GAIpB,SAASvB,EAASwB,EAAKC,EAAMC,EAASC,GAErCb,KAAKU,IAAa,MAAPA,EAAcA,EAAM,KAC/BV,KAAKW,KAAe,MAARA,EAAeA,EAAO,KAEnB,MAAXC,IAEHA,EAAU,IAGE,MAATC,IAEHA,GAAQ,GAGTxB,KAAKuB,EAASxB,gBACdY,KAAKY,QAAUtB,eAAesB,EAASZ,KAAKW,KAAMX,KAAKU,KACvDV,KAAKc,QAAU,QAAUd,KAAKY,QAAQG,KAAK,KAEvCF,GAEHb,KAAKa,QAgDP,OAvEAnB,UAAUR,EAyERC,cA9CFD,EAASgB,UAAUW,MAAQ,WAE1B,IAAIG,EAAUC,EAEd,GAAiB,OAAbjB,KAAKU,KAA8B,OAAdV,KAAKW,KAE7B,MAAM,IAAIO,MAAM,kEA8BjB,OA1BAD,EAAe,EACfjB,KAAKmB,eAAiB5B,MAAM,OAAQS,KAAKY,SACzCI,EAAWhB,KAEXA,KAAKmB,eAAeC,GAAG,OAAQ,SAASC,GAEvCL,EAASM,KAAK,MAAOD,KAGtBrB,KAAKmB,eAAeI,OAAOH,GAAG,OAAQ,SAASI,GAE9C,IAAIC,EACJD,EAAOA,EAAKE,SAAS,SAEjB,iBAAiBC,KAAKH,KAEzBC,EAAWG,SAASC,OAAOC,UAAW,IAElCb,IAAiBQ,GAAYA,GAAYR,IAE5CA,EAAeQ,EACfT,EAASM,KAAK,WAAYG,OAKtBzB,KAAKmB,eAAeY,MAAMC,OAGlC9C,EAASgB,UAAU+B,KAAO,WAEzBjC,KAAKmB,eAAee,QAGdhD,EAzEG,GA+EXI,eAAiB,SAASsB,EAASD,EAAMD,GAExC,IAAIyB,EAAOtC,EAAKuC,EAGf,IAAKvC,KAFLsC,EAAQ,GAEIvB,EAEXwB,EAASxB,EAAQf,GACjBsC,EAAQA,EAAME,OAAOD,GAItB,OADAD,EAAQA,EAAME,OAAO,CAAC,KAAM1B,EAAMD,KAIpCrB,KAAO,SAASsB,EAAM2B,GAErB,IAAIzC,EAAK0C,EAAIC,EAAMC,EAAMC,EAKzB,IAFAA,EAAW,GAENH,EAAK,EAAGC,GAHbC,EAAOE,OAAOC,KAAKN,IAGMO,OAAQN,EAAKC,EAAMD,SAIzB,IAAd5B,EAFJd,EAAM4C,EAAKF,IAIVG,EAASI,KAAKnC,EAAKd,GAAOyC,EAAIzC,IAI9B6C,EAASI,UAAK,GAIhB,OAAOJ,GAIRK,OAAOC,QAAQ9D,SAAWA","file":"../download.min.js","sourcesContent":["/* curl downloader: https://github.com/hyspace/node-curl-download/blob/master/download.js */\n\n'use strict'\n\nvar Download,\n\tEventEmitter,\n\tdefaultOptions,\n\tfill,\n\tgetOptionArray,\n\tspawn,\n\t__hasProp = {}.hasOwnProperty,\n\t__extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nspawn = require(\"child_process\").spawn;\n\nEventEmitter = require(\"events\").EventEmitter;\n\ndefaultOptions = {\n\t\n\tcreateDirs: ['--create-dirs'],\n\tinsecure: ['--insecure'],\n\tpercentage: ['--progress-bar'],\n\tfollowRedirect: ['--location']\n};\n\nDownload = (function(_super) {\n\t\n\t__extends(Download, _super);\n\n\tfunction Download(url, dest, options, start) {\n\n\t\tthis.url = url != null ? url : null;\n\t\tthis.dest = dest != null ? dest : null;\n\t\t\n\t\tif (options == null) {\n\n\t\t\toptions = {};\n\t\t}\n\n\t\tif (start == null) {\n\n\t\t\tstart = false;\n\t\t}\n\n\t\tfill(options, defaultOptions);\n\t\tthis.options = getOptionArray(options, this.dest, this.url);\n\t\tthis.command = 'curl ' + this.options.join(' ');\n\n\t\tif (start) {\n\t\t\n\t\t\tthis.start();\n\t\t}\n\t}\n\n\tDownload.prototype.start = function() {\n\n\t\tvar download, lastProgress;\n\t\t\n\t\tif (this.url === null || this.dest === null) {\n\t\t\t\n\t\t\tthrow new Error(\"node-curl-download: Url and destination path must be provided.\");\n\t\t\treturn;\n\t\t}\n\n\t\tlastProgress = 0;\n\t\tthis._child_process = spawn('curl', this.options);\n\t\tdownload = this;\n\t\t\n\t\tthis._child_process.on('exit', function(code) {\n\t\t\t\n\t\t\tdownload.emit('end', code);\n\t\t});\n\n\t\tthis._child_process.stderr.on('data', function(data) {\n\n\t\t\tvar progress;\n\t\t\tdata = data.toString('ascii');\n\t\t\t\n\t\t\tif (/\\d+(\\.\\d{1,2})/.test(data)) {\n\n\t\t\t\tprogress = parseInt(RegExp.lastMatch, 10);\n\t\t\t\t\n\t\t\t\tif (lastProgress !== progress && progress >= lastProgress) {\n\t\t\t\t\t\n\t\t\t\t\tlastProgress = progress;\n\t\t\t\t\tdownload.emit(\"progress\", progress);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this._child_process.stdin.end();\n\t};\n\n\tDownload.prototype.stop = function() {\n\t\t\n\t\tthis._child_process.kill();\n\t};\n\n\treturn Download;\n\n})(EventEmitter);\n\n\n\ngetOptionArray = function(options, dest, url) {\n\n\tvar array, key, option;\n\t\tarray = [];\n\n\t\tfor (key in options) {\n\t\t\t\n\t\t\toption = options[key];\n\t\t\tarray = array.concat(option);\n\t\t}\n\n\t\tarray = array.concat(['-o', dest, url]);\n\t\treturn array;\n};\n\nfill = function(dest, src) {\n\t\n\tvar key, _i, _len, _ref, _results;\n\t\n\t_ref = Object.keys(src);\n\t_results = [];\n\n\tfor (_i = 0, _len = _ref.length; _i < _len; _i++) {\n\t\t\n\t\tkey = _ref[_i];\n\t\t\n\t\tif (dest[key] === void 0) {\n\n\t\t\t_results.push(dest[key] = src[key]);\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\t_results.push(void 0);\n\t\t}\n\t}\n\t\n\treturn _results;\n};\n\n\nmodule.exports.Download = Download;\n"]}