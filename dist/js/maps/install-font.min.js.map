{"version":3,"sources":["install-font.js"],"names":["electron","require","BrowserWindow","app","dialog","extract","fs","Store","store","tempPath","getPath","Download","dl","downloadFont","id","name","zip","on","progress","console","log","code","dir","err","showErrorBox","removeSync","moveSync","get","getFocusedWindow","webContents","send","start","event"],"mappings":"AAAA,aAEA,MAAMA,SAAWC,QAAQ,YACnBC,cAAgBF,SAASE,cACzBC,IAAMH,SAASG,IACfC,OAASH,QAAQ,YAAYG,OAC7BC,QAAUJ,QAAQ,eAClBK,GAAKL,QAAS,YACdM,MAAQN,QAAQ,kBAChBO,MAAQ,IAAID,MACZE,SAAWN,IAAIO,QAAQ,QAC7B,IAAIC,SAAUC,GAQd,SAASC,aAAaC,EAAIC,EAAMC,IAE/BJ,GAAK,IAAID,SAAS,0DAA4DG,EAAK,0CAA2CE,IAE3HC,GAAG,WAAaC,IAElBC,QAAQC,IAAKL,EAAO,gBAAkBG,EAAW,OAGlDN,GAAGK,GAAG,MAAQI,IAEA,IAATA,GAEHF,QAAQC,IAAI,yBAEZf,QAASW,GAAOM,IAAKb,SAAW,sCAAwCM,EAAO,KAAM,SAAUQ,GAE1FA,EAEHnB,OAAOoB,aACN,uCAAyCT,EAAMQ,EAAIF,OAKpDf,GAAGmB,WAAYT,GAEfV,GAAGoB,SAAUjB,SAAW,sCAAwCM,EAAMP,MAAMmB,IAAI,8BAAgCZ,GAEhHb,cAAc0B,mBAAmBC,YAAYC,KAAK,eAAgBf,QAMpEX,OAAOoB,aACN,sCACA,YAAcT,EAAO,uBAGtBb,cAAc0B,mBAAmBC,YAAYC,KAAK,eAAgB,yBAIpElB,GAAGmB,QAlDJpB,SAAWV,QAAQ,kBAAkBU,SAuDrCR,IAAIc,GAAG,eAAiBe,IAEvB,IAAIlB,GAAEA,EAAEC,KAAEA,GAASiB,EACfhB,EAAMP,SAAW,sCAAwCK,EAAK,OAElEZ,cAAc0B,mBAAmBC,YAAYC,KAAK,gBAAiBf,GACnEF,aAAcC,EAAIC,EAAMC","file":"../install-font.min.js","sourcesContent":["'use strict'\n\nconst electron = require('electron')\nconst BrowserWindow = electron.BrowserWindow\nconst app = electron.app\nconst dialog = require('electron').dialog\nconst extract = require('extract-zip')\nconst fs = require( 'fs-extra' )\nconst Store = require('electron-store')\nconst store = new Store()\nconst tempPath = app.getPath('temp')\nvar Download, dl\n\nDownload = require('./download.min').Download\n\n\n\n//note(@duncanmid): download and unzip font\n\nfunction downloadFont(id, name, zip) {\n\t\n\tdl = new Download('https://google-webfonts-helper.herokuapp.com/api/fonts/' + id + '?download=zip&subsets=latin&formats=ttf', zip)\n\t\n\tdl.on('progress', (progress) => {\n\t\t\n\t\tconsole.log( name + \" - download: \" + progress + \"%\" )\n\t})\n\t\n\tdl.on('end', (code) => {\n\t\t\n\t\tif (code === 0) {\n\t\t\t\n\t\t\tconsole.log(\"finished successfully\")\n\t\t\t\n\t\t\textract( zip , {dir: tempPath + '/com.midwinter-dg.mdg-font-manager/' + name + '/'}, function (err) {\n\t\t\t\t\n\t\t\t\tif( err ) {\n\t\t\t\t\t\n\t\t\t\t\tdialog.showErrorBox(\n\t\t\t\t\t\t'An error occured whilst extracting: ' + name, err.code\n\t\t\t\t\t)\n\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\tfs.removeSync( zip )\n\t\t\t\t\t\n\t\t\t\t\tfs.moveSync( tempPath + '/com.midwinter-dg.mdg-font-manager/' + name, store.get('fontDirectories.activePath') + name)\n\t\t\t\t\t\n\t\t\t\t\tBrowserWindow.getFocusedWindow().webContents.send('remove-bezel', name)\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\tdialog.showErrorBox(\n\t\t\t\t'An error occured whilst downloading',\n\t\t\t\t'The font ' + name + ' was not downloaded'\n\t\t\t)\n\t\t\t\n\t\t\tBrowserWindow.getFocusedWindow().webContents.send('remove-bezel', 'font-not-installed')\n\t\t}\n\t})\n\t\t\n\tdl.start()\n}\n\n\n\napp.on('install-font', (event) => {\n\t\n\tvar { id, name } = event\n\tvar zip = tempPath + '/com.midwinter-dg.mdg-font-manager/' + id + '.zip'\n\t\n\tBrowserWindow.getFocusedWindow().webContents.send('display-bezel', name)\n\tdownloadFont( id, name, zip )\n})\n"]}