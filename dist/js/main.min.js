"use strict";const{app:app,BrowserWindow:BrowserWindow,shell:shell,ipcMain:ipcMain}=require("electron"),url=require("url"),path=require("path"),dialog=require("electron").dialog,Store=require("electron-store"),fs=require("fs-extra"),chokidar=require("chokidar");let win,watcher,store=new Store({defaults:{windowBounds:{width:800,height:600,x:0,y:0},fontDirectories:{activePath:app.getPath("home")+"/Library/Fonts/",disabledPath:app.getPath("home")+"/Library/Fonts Disabled/"},fontOrder:{active:0,disabled:0},fontPreview:{size:8,color:"#000000"},appPrefs:{dividers:!1,extensions:!0}}});function createWindow(){let{x:e,y:t,width:o,height:i}=store.get("windowBounds");function n(){store.set("windowBounds",win.getBounds())}(win=new BrowserWindow({show:!1,titleBarStyle:"hidden",x:e,y:t,width:o,height:i,minWidth:400,minHeight:300,backgroundColor:"#031320",icon:path.join(__dirname,"../assets/icon/Icon.icns")})).setSheetOffset(24),win.loadURL(url.format({pathname:path.join(__dirname,"../html/app.html"),protocol:"file:",slashes:!0})),win.once("ready-to-show",win.show),win.on("show",()=>{checkPaths("active"),checkPaths("disabled")}),win.on("resize",n),win.on("move",n),win.on("focus",()=>{void 0!==watcher&&watcher.close()}),win.on("blur",watchOnce),win.on("closed",app.quit),require("./app-menu.min"),require("./list-menus.min"),require("./font-menu.min"),require("./glyph-menu.min"),require("./install-font.min")}function chooseFolder(e){let t=store.get("fontDirectories."+`${e}Path`),o=capitalize(e);dialog.showOpenDialog(win,{defaultPath:t,buttonLabel:"Choose "+o+" Fonts Folder",properties:["openDirectory","showHiddenFiles","createDirectory"]},function(t){t&&(store.set("fontDirectories."+`${e}Path`,t[0]+"/"),win.webContents.send("update-path"))})}function exportFonts(e){dialog.showSaveDialog(win,{defaultPath:app.getPath("desktop")+"/Exported Fonts",buttonLabel:"Export Fonts"},function(t){if(void 0===t)return;{let o=0;for(let i=0,n=e.length;i<n;i++)try{fs.copySync(e[i][1],t+"/"+e[i][0])}catch(e){o++,console.log(e)}finally{i+1==n&&(o>1?win.webContents.send("export-failed"):win.webContents.send("export-ok",t))}}})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function checkPaths(e){let t,o=capitalize(e),i=`The ${o} Folder is not yet set.`,n="disabled"===e?"Please choose or create a folder to store disabled fonts in:":`Please set it to: ${app.getPath("home")}/Library/Fonts/`;if(!fs.existsSync(store.get(`fontDirectories.${e}Path`)))switch(e){case"active":t=dialog.showErrorBox(i,n),store.set("fontDirectories.activePath",`${app.getPath("home")}/Library/Fonts/`),win.webContents.send("update-path");break;case"disabled":0===(t=dialog.showMessageBox({message:i,detail:n,buttons:[`Choose ${o} Fonts Folder`,"Cancel"]}))&&chooseFolder(`${e}`)}}function watchOnce(){watcher=chokidar.watch([store.get("fontDirectories.activePath"),store.get("fontDirectories.disabledPath")],{ignored:/(^|[\/\\])\../,ignoreInitial:!0,persistent:!0,depth:0}).on("all",(e,t)=>{watcher.close(),setTimeout(function(){win.webContents.send("reload")},1e3),setTimeout(watchOnce,1e3)})}app.on("ready",createWindow),app.on("open-folder",e=>{shell.openExternal("file://"+store.get(`fontDirectories.${e}Path`))}),app.on("choose-folder",e=>{chooseFolder(e)}),app.on("export-single",e=>{exportFonts([e])}),ipcMain.on("export-list",(e,t)=>{exportFonts(t)}),ipcMain.on("set-prefs",(e,t)=>{win.webContents.send("reload")}),ipcMain.on("import",(e,t)=>{let o="left-panel"==t.location?store.get("fontDirectories.activePath"):store.get("fontDirectories.disabledPath"),i=0;for(let e=0,n=t.list.length;e<n;e++){let r=t.list[e].split("/").pop();try{fs.moveSync(t.list[e],o+r,{overwrite:!0})}catch(e){i++,console.log(e)}finally{e+1==n&&(i>1?win.webContents.send("import-failed"):win.webContents.send("import-ok",o))}}});
//# sourceMappingURL=maps/main.min.js.map
